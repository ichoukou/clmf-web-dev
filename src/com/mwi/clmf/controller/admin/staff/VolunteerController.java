package com.mwi.clmf.controller.admin.staff;import java.io.BufferedInputStream;import java.io.BufferedOutputStream;import java.io.File;import java.io.FileInputStream;import java.io.InputStream;import java.io.OutputStream;import javax.servlet.http.Cookie;import com.jfinal.core.Controller;import com.jfinal.kit.PathKit;import com.jfinal.plugin.activerecord.Page;import com.jfinal.upload.UploadFile;import com.mwi.clmf.model.meeting.NewsModel;import com.mwi.clmf.model.staff.WorkerInforModel;import com.mwi.clmf.service.admin.staff.WokerInforService;public class VolunteerController extends Controller {	public void index(){		String realname = getPara("realname");		String work_group = getPara("work_group");		String unit = getPara("unit");		String post = getPara("post");		String skill = getPara("skill");		String id_no = getPara("id_no");		String phone = getPara("phone");		String wechat_username = getPara("wechat_username");		Integer currentPage = getParaToInt("currentPage") == null ? 1 : getParaToInt("currentPage");		Integer currentSize = getParaToInt("currentSize") == null ? 10 : getParaToInt("currentSize");				Page<WorkerInforModel> pageList =  WorkerInforModel.wiDao.getWorkerList(realname, work_group, unit, post, skill,id_no,phone,wechat_username, currentPage, currentSize,2);				setAttr("volunteerList",pageList);		setAttr("currentPage", currentPage);		setAttr("currentSize", currentSize);		setAttr("realname", realname);		setAttr("work_group", work_group);		setAttr("unit", unit);		setAttr("post", post);		setAttr("skill", skill);		setAttr("id_no", id_no);		setAttr("phone", phone);				render("mwi_personnel_volunteerInfo.jsp");	}		public void save(){		String realname = getPara("realname");		String id_no = getPara("id_no");		String sex = getPara("sex");		String phone = getPara("phone");		String email = getPara("email");		String wechat_username = getPara("wechat_username");		String unit = getPara("unit");		String post = getPara("post");		String skill = getPara("skill");				new WorkerInforModel().				set("realname", realname).				set("id_no", id_no).				set("sex", sex).				set("phone", phone).				set("email", email).				set("wechat_username", wechat_username).				set("unit", unit).				set("post", post).				set("skill", skill).				set("working_state", 0).				set("groupping_state", 0).				set("worker_type", 2).				set("is_bind_checkStand", 0).				set("is_bind_DiningStand", 0).save();		redirect("/volunteer");	}		public void update(){		String vOId=getPara("vOId");		String realname = getPara("realname");		String id_no = getPara("id_no");		String sex = getPara("sex");		String phone = getPara("phone");		String email = getPara("email");		String wechat_username = getPara("wechat_username");		String unit = getPara("unit");		String post = getPara("post");		String skill = getPara("skill");				new WorkerInforModel().findById(vOId).				set("realname", realname).				set("id_no", id_no).				set("sex", sex).				set("phone", phone).				set("email", email).				set("wechat_username", wechat_username).				set("unit", unit).				set("post", post).				set("skill", skill).				set("working_state", 0).				set("groupping_state", 0).				set("worker_type", 2).				set("is_bind_checkStand", 0).				set("is_bind_DiningStand", 0).update();		redirect("/volunteer");	}		public void findByVoId(){		renderJson("volunteer",new WorkerInforModel().findById(getPara()));	}		public void deleteByVoId(){		new WorkerInforModel().deleteById(getPara());		redirect("/volunteer");	}		public void bathdelVolunteer(){		String voId = getPara("voId");		String[] voIds = voId.split(",");		for(int i=0; i<voIds.length; i++){			new WorkerInforModel().deleteById(voIds[i]);		}		redirect("/volunteer");	}		public void importVolunteer(){		UploadFile uf = getFile("file", "UTF-8");		boolean bl = WokerInforService.wokerInforService.importVolunteer(uf.getFile());		Cookie cookie = new Cookie("responseCode", bl ? "1" : "0");		getResponse().addCookie(cookie);		render("mwi_personnel_volunteerInfo.jsp");	}		public void uploadTemplate(){		String path = PathKit.getWebRootPath()+"/template/volunteer_info_template.xls";		try{			File file = new File(path);			String filename = file.getName();			InputStream fis = new BufferedInputStream(new FileInputStream(path));			byte[] buffer = new byte[fis.available()];            fis.read(buffer);            fis.close();	        // 设置输出的格式	        getResponse().reset();	        getResponse().addHeader("Content-Disposition", "attachment;filename=" + new String(filename.getBytes()));	        getResponse().addHeader("Content-Length", "" + file.length());            OutputStream toClient = new BufferedOutputStream(getResponse().getOutputStream());            getResponse().setContentType("application/octet-stream");            toClient.write(buffer);            toClient.flush();            toClient.close();		}catch(Exception e){			e.printStackTrace();		}	}}